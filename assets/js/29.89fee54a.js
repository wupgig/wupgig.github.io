(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{396:function(t,a,s){"use strict";s.r(a);var n=s(47),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"docker-rabbitmq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-rabbitmq"}},[t._v("#")]),t._v(" Docker RabbitMQ")]),t._v(" "),s("p",[t._v("RabbitMQ 的 Docker 镜像在 dockerhub 上的网址："),s("a",{attrs:{href:"https://hub.docker.com/_/rabbitmq",target:"_blank",rel:"noopener noreferrer"}},[s("em",[t._v("https://hub.docker.com/_/rabbitmq")]),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("当前"),s("small",[t._v("（2021-04-02）")]),t._v("的 "),s("strong",[t._v("latest")]),t._v(" 和 "),s("strong",[t._v("3.8.21")]),t._v(" 是同一个镜像 。")]),t._v(" "),s("p",[t._v("不过，我们选择带有 "),s("strong",[t._v("management")]),t._v(" 的版本的镜像，因为其中包含 web 管理页面。例如："),s("strong",[t._v("rabbitmq:3.8.21-management")]),t._v(" 。")]),t._v(" "),s("h2",{attrs:{id:"_1-安装及测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装及测试"}},[t._v("#")]),t._v(" 1. 安装及测试")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查询中央仓库")]),t._v("\ndocker search -f is-official"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true rabbitmq\n    \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 从中央仓库下载")]),t._v("\ndocker pull rabbitmq:3.8.21-management\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或，直接导入已有的镜像文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker load -i rabbitmq-3.8.21-management.tar")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看本地镜像")]),t._v("\ndocker images\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 会出现类似如下内容：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# REPOSITORY      TAG                 IMAGE ID       CREATED        SIZE")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rabbitmq        3.8.21-management   b752ffe108c3   34 hours ago    249MB")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rabbitmq        3.8.21              7c1815579c8b   34 hours ago    216MB")]),t._v("\n")])])]),s("p",[t._v("运行容器：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除曾经已有的同名容器")]),t._v("\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -f rabbitmq-test\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建并运行 rabbitmq 容器的语法")]),t._v("\ndocker run "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("指定容器名"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -p "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("指定宿主机端口"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":5672 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  rabbitmq:3.8.21-management\n")])])]),s("p",[t._v("例如：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("docker run "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --name rabbitmq-test "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5672")]),t._v(":5672 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15672")]),t._v(":15672 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  rabbitmq:3.8.21-management\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker run -d --name rabbitmq-test -p 5672:5672 -p 15672:15672 rabbitmq:3.8.21-management")]),t._v("\n")])])]),s("p",[t._v("验证安装成功")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("通过 "),s("strong",[t._v("docker ps")]),t._v(" 命令查看容器的运行信息：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("docker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n")])])]),s("p",[t._v("会看到类似如下信息：")]),t._v(" "),s("p",[t._v("略")])]),t._v(" "),s("li",[s("p",[t._v("访问 management web 管理系统。")]),t._v(" "),s("p",[t._v("由于我们使用的是 management 镜像创建的容器，因此，容器自带了后台管理系统。我们可以通过我们映射的 "),s("strong",[t._v("15672")]),t._v(" 端口访问。")]),t._v(" "),s("p",[t._v("访问网址 "),s("code",[t._v("http://宿主机IP:15672")]),t._v(" ，使用 guest / guest 登录。"),s("small",[t._v("有一点点延迟，启动容器后稍等片刻。")])]),t._v(" "),s("blockquote",[s("p",[t._v("注意，虽然用户名是叫 "),s("strong",[t._v("guest")]),t._v(" ，但是它的角色是管理员 administrator 。")])]),t._v(" "),s("p",[t._v("当然，你也可以手动指定登录管理系统的用户名和密码：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("docker run "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -e "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("RABBITMQ_DEFAULT_USER")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("自定义用户名"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(" \n  -e "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("RABBITMQ_DEFAULT_PASS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("自定义密码"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(" \n  rabbitmq:3.8.21-management\n")])])])])]),t._v(" "),s("h2",{attrs:{id:"_2-配置与挂载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置与挂载"}},[t._v("#")]),t._v(" 2. 配置与挂载")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Docker RabbitMQ 的配置文件时容器中的 "),s("strong",[t._v("/etc/rabbitmq/rabbitmq.config")]),t._v(" 。")]),t._v(" "),s("p",[t._v("其中的有效内容为：")]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("loopback_users.guest")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("listeners.tcp.default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("5672")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("management.tcp.port")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("15672")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("RabbitMQ 的数据存储依赖于 "),s("strong",[t._v("docker run")]),t._v(" 命令中的 "),s("strong",[t._v("--hostname")]),t._v(" 属性的属性值。")]),t._v(" "),s("p",[t._v("由于我们在创建容器时并没有指定容器的 "),s("strong",[t._v("--hostname")]),t._v(" ，Docker 会为我们创建的容器随机分配一个 "),s("em",[t._v("hostname")]),t._v(" ，例如："),s("em",[s("code",[t._v("12e22c2be88d")])]),t._v(" 。")]),t._v(" "),s("p",[t._v("这种情况下，rabbitmq 的数据的存储路径就是容器中的： "),s("strong",[t._v("/var/lib/rabbitmq/mnesia/rabbit@12e22c2be88d")]),t._v(" 。")]),t._v(" "),s("p",[t._v("很显然，这种随机性很不方便，因此我们还是创建容器时自己指定 "),s("strong",[t._v("--hostname")]),t._v(" 的好。")])]),t._v(" "),s("li",[s("p",[t._v("示例：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除已存在的同名容器")]),t._v("\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -f rabbitmq-5672\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建宿主机挂载目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p ~/docker/rabbitmq/5672/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("data,config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建并运行容器")]),t._v("\ndocker run "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    -d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --hostname rabbitmq-5672 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --name rabbitmq-5672 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5672")]),t._v(":5672 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15672")]),t._v(":15672 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    -v ~/docker/rabbitmq/5672/data:/var/lib/rabbitmq/mnesia/rabbit@rabbitmq-5672 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    rabbitmq:3.8.21-management\n")])])])])]),t._v(" "),s("h2",{attrs:{id:"_3-docker-compose-启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-docker-compose-启动"}},[t._v("#")]),t._v(" 3. docker-compose 启动")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rabbitmq")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3.8.21"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("management\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rabbitmq\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5672")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" RABBITMQ_DEFAULT_USER=root\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" RABBITMQ_DEFAULT_PASS=root\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/rabbitmq\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5672:5672"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"15672:15672"')]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);