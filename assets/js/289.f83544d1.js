(window.webpackJsonp=window.webpackJsonp||[]).push([[289],{657:function(t,a,s){"use strict";s.r(a);var e=s(47),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"服务注册与发现-eureka"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务注册与发现-eureka"}},[t._v("#")]),t._v(" 服务注册与发现：Eureka")]),t._v(" "),s("p",[t._v("在微服务架构中，每一个微服务都可以通过集群或者其它方式进行动态扩展，每一个微服务实例的网络地址都可能动态变化，这使得原本通过『"),s("strong",[t._v("硬编码地址的调用方式失去了作用")]),t._v("』。")]),t._v(" "),s("p",[t._v("微服务架构中，服务地址的动态变化和数量变动，迫切需要系统建立一个『"),s("strong",[t._v("中心化的组件")]),t._v("』对各个微服务实例信息进行登记和管理，同时让各个微服务实例之间能够相互发现，从而达到互相调用的结果。")]),t._v(" "),s("dl",[s("dt",[t._v("服务注册")]),t._v(" "),s("dd",[t._v("服务在中央注册表中注册其服务位置的过程。通常注册其主机和端口，有时还注册认证凭证，协议，版本号和或环境信息。")]),t._v(" "),s("dt",[t._v("服务发现")]),t._v(" "),s("dd",[t._v("客户端应用程序查询中央注册表以了解服务位置的过程。")])]),t._v(" "),s("p",[t._v("维护中央注册表的角色被称为『"),s("strong",[t._v("服务注册平台")]),t._v("』或者『"),s("strong",[t._v("服务注册中心")]),t._v("』。")]),t._v(" "),s("p",[t._v("当一个微服务启动的时候，必须主动向服务注册中心注册其服务地址，以供其他微服务查询调用。图中橘黄色为服务注册中心，绿色为微服务节点。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/spring-cloud/img/Eureka-3.png",alt:"图片"}})]),t._v(" "),s("p",[t._v("当一个微服务有多个实例的时候，由调用者从服务注册中心获取注册服务列表；调用者拿到『"),s("strong",[t._v("注册服务列表")]),t._v("』之后，决定访问哪一个服务实例。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/spring-cloud/img/Eureka-4.png",alt:"图片"}})]),t._v(" "),s("h2",{attrs:{id:"_1-spring-cloud-常用的服务注册中心"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-spring-cloud-常用的服务注册中心"}},[t._v("#")]),t._v(" 1. Spring Cloud 常用的服务注册中心")]),t._v(" "),s("p",[t._v("Spring Cloud Netflix "),s("strong",[t._v("Eureka")]),t._v(" 是 Spring Cloud 提供用于服务于发现和注册的基础组件，是搭建 Spring Cloud 微服务架构的前提之一。")]),t._v(" "),s("p",[t._v("Eureka 由两部分组成：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("一个是 Eureka Server，提供服务注册和发现功能，即，我们上述的服务器端；")])]),t._v(" "),s("li",[s("p",[t._v("另一个是 Eureka Client，它简化了客户端与服务端之间的交互。")])])]),t._v(" "),s("p",[t._v("Eureka Client 会定时将自己的注册信息登记到 Eureka Server 中，并从 Server 中下载包括了其它 Eurek Client 信息的『注册表』。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("基本架构：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/spring-cloud/img/Eureka-1.png",alt:"图片"}})])])]),t._v(" "),s("h2",{attrs:{id:"_2-服务注册中心-registry-center"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-服务注册中心-registry-center"}},[t._v("#")]),t._v(" 2. 服务注册中心（Registry Center）")]),t._v(" "),s("p",[t._v("首先，创建一个 Spring Boot Maven 工程，通过")]),t._v(" "),s("p",[t._v("引入依赖：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("在 Spring Initializer"),s("small",[t._v("（https://start.spring.io、https://start.aliyun.com）")]),t._v("中搜索 "),s("strong",[t._v("Eureka Server")]),t._v(" 后再选中。或")])]),t._v(" "),s("li",[s("p",[t._v("在 "),s("strong",[t._v("Spring Cloud Discovery")]),t._v(" 下选中 "),s("strong",[t._v("Eureka Server")]),t._v(" 。")])])]),t._v(" "),s("p",[t._v("注意事项：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("这里『"),s("strong",[t._v("不需要")]),t._v("』引入 "),s("em",[t._v("Spring Web")])])]),t._v(" "),s("li",[s("p",[t._v("除非完全没有网络，而无法利用 Spring Initializer 功能，否则对于初学者而言，不要自己去创建普通的 Maven 项目后再添加相关包的依赖。这样做很容易遗漏和出错。")])]),t._v(" "),s("li",[s("p",[t._v("被引入的依赖项是：")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-netflix-eureka-server"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])])]),t._v(" "),s("p",[t._v("创建启动类 "),s("strong",[t._v("RegistryApplication.java")]),t._v(" ：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@SpringBootApplication")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableEurekaServer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 看这里，看这里，看这里")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RegistryApplication")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringApplication")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RegistryApplication")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这里，我们注意到除了前面提到的 @SpringBootApplication 外，这个类还增加了一个注解："),s("strong",[t._v("@EnableEurekaServer")]),t._v(" ，这个注解的作用就是标注该应用程序是一个注册中心，只是添加这个注解还不够，还需要增加配置。")]),t._v(" "),s("p",[t._v("为项目添加配置文件：")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("application.yml")]),t._v(" 配置文件"),s("small",[t._v("（先看执行效果，特殊配置的细节，后续讲解）")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8761")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" eureka"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ${spring.cloud.client.ip-address}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 微服务的唯一标识")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance-id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("eureka.instance.hostname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("server.port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefer-ip-address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 不向注册中心注册自己")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("register-with-eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 不从 Eureka Server 获取服务的注册信息")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fetch-registry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("eureka.instance.hostname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("server.port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/eureka/\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enable-self-preservation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在较新的版本中，关闭自保护模式会告警。")]),t._v("\n")])])]),s("p",[t._v("在这里，我们通过 "),s("code",[t._v("eureka.instance.hostname")]),t._v(" 配置项『写死』了我们的微服务项目的 IP 地址，实际上，在 spring cloud 中有一个内置的变量 "),s("code",[t._v("${spring.cloud.client.ip-address}")]),t._v("，可以通过它去『求得』当前服务器的 IP 地址，而不用写死。")]),t._v(" "),s("p",[s("strong",[t._v("注意")]),t._v(" 如果你的当前服务器有多个 IP ，那么，这里还需要其它配置搭配使用，才能保证合乎你心意。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("bootstrap.yml")]),t._v(" 配置文件：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 日志相关配置，略。")]),t._v("\n")])])])])]),t._v(" "),s("p",[t._v("启动该应用程序，打开浏览器并访问: "),s("a",{attrs:{href:"http://localhost:8761",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost:8761"),s("OutboundLink")],1),t._v(" 。如果看到如下界面，说明注册中心已经启动起来了:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/spring-cloud/img/spring-cloud-registry.png",alt:"registry"}})]),t._v(" "),s("p",[t._v("下面说明一下注册中心各个配置项的含义:")]),t._v(" "),s("ul",[s("li",[s("h3",[t._v("eureka.server.enable-self-preservation")]),t._v(" "),s("p",[t._v("是否开启自我保护，默认为 true 。")]),t._v(" "),s("p",[s("strong",[t._v("15")]),t._v(" 分钟内超过 "),s("strong",[t._v("85%")]),t._v(" 的客户端节点都掉线了，注册中心就认为是自己掉线，而非客户端掉线。这种情况下，注册中心不会将不可用客户端节点信息从注册表中移除，而是等待网络恢复。")]),t._v(" "),s("p",[t._v("这里设置为 false ，即关闭自我保护。")]),t._v(" "),s("p",[t._v("在开发过程中，我们很容易频繁地启动、关停、重启客户端，从而很容易达到自我保护模式的标准。这时，会导致注册中心会『残留』已关闭的客户端信息。因此，开发环境中建议关闭自我保护模式。")]),t._v(" "),s("p",[s("small",[t._v("不过在最新的、高版本的 spring cloud 中关闭 Eureka Server 的自我保护模式会有警告信息。")])])]),t._v(" "),s("li",[s("h3",[t._v("eureka.instance.prefer-ip-address")]),t._v(" "),s("p",[t._v("是否以客户端节点的 IP 为标识注册到注册中心"),s("small",[t._v("（的注册表）")]),t._v("，默认是以客户端节点的 hostname 来注册的。")]),t._v(" "),s("p",[s("small",[t._v("这个配置，和 instance-id 不是一码事。")])])]),t._v(" "),s("li",[s("h3",[t._v("eureka.client.serviceUrl.defaultZone")]),t._v(" "),s("p",[t._v("注册中心默认地址。这里看起来似乎有点奇怪：为什么 Eureka Server 需要配置 Eureka Server 的 URL ？")]),t._v(" "),s("p",[t._v("因为 Eureka Server 可以集群部署，而在居群部署的情况下，Eureka Server 之间会进行注册表信息的同步操作。因此，每个 Eureka Server 需要『感知』其它的 Eureka Server 的存在。")]),t._v(" "),s("p",[t._v("一个 Eureka Server 也是一个 Eureka Client，它会尝试其它的 Eureka Server 那注册自己，所以需要至少一个注册中心的 URL 来定位其它的 Eureka Server 。如果不提供这样一个注册端点，注册中心也能工作，但是会在日志中打印无法向注册中心注册自己的信息。")])])]),t._v(" "),s("blockquote",[s("p",[t._v("建议按照以上的配置项写就行了。")])]),t._v(" "),s("p",[t._v("Eureka Server 与 Eureka Client 之间的联系主要通过心跳的方式实现。心跳"),s("small",[t._v("（Heartbeat）")]),t._v("即 Eureka Client 定时向 Eureka Server 汇报本服务实例当前的状态，维护本服务实例在注册表中租约的有效性。")]),t._v(" "),s("p",[t._v("为了避免 Eureka Client 在每次服务间调用都向注册中心请求所依赖的服务实例的信息，Eureka Client 将定时从 Eureka Server 中拉取注册表中的信息，并将这些信息缓存到本地，用于服务发现。")]),t._v(" "),s("h2",{attrs:{id:"_3-服务提供者-service-producer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-服务提供者-service-producer"}},[t._v("#")]),t._v(" 3. 服务提供者（Service Producer）")]),t._v(" "),s("p",[t._v("我们有了注册中心，那么就可以创建一个服务提供者（即客户端）注册到注册中心去了。")]),t._v(" "),s("br"),t._v(" "),s("hr"),t._v(" "),s("br"),t._v(" "),s("p",[t._v("同样地，按照注册中心的创建方式，创建领一个 Spring Boot Maven 项目，通过 "),s("code",[t._v("http://start.spring.io")]),t._v(" 或 "),s("code",[t._v("https://start.aliyun.com")]),t._v(" 所提供的 Spring Initializer 功能，引入依赖：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("在 Initializer 中搜索 "),s("strong",[t._v("Eureka Discovery Client")]),t._v(" 后再选中。或")])]),t._v(" "),s("li",[s("p",[t._v("在 "),s("strong",[t._v("Spring Cloud Discovery")]),t._v(" 下选中 "),s("strong",[t._v("Eureka Discovery Client")]),t._v(" 。")])])]),t._v(" "),s("p",[t._v("注意事项：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("这里『"),s("strong",[t._v("需要")]),t._v("』引入 "),s("strong",[t._v("Spring Web")]),t._v(" 。")])]),t._v(" "),s("li",[s("p",[t._v("除非完全没有网络，而无法利用 Spring Initializer 功能，否则对于初学者而言，不要自己去创建普通的 Maven 项目后再添加相关包的依赖。这样做很容易遗漏和出错。")])]),t._v(" "),s("li",[s("p",[t._v("实际引入的依赖项目是")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-web"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-netflix-eureka-client"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])])]),t._v(" "),s("p",[t._v("然后创建 "),s("strong",[t._v("EurekaProducer1Application.java")]),t._v(" ：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@SpringBootApplication")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableEurekaClient")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 看这里，看这里，看这里")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EurekaProducer1Application")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringApplication")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EurekaProducer1Application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RestController")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TempController")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${server.port}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/hello"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("home")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hi "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('", i am from port:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这里用到了一个注解："),s("strong",[t._v("@EnableEurekaClient")]),t._v("，标注了此注解，说明该项目是一个服务提供者。")]),t._v(" "),s("p",[t._v("为项目添加配置项：")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("application.yml")]),t._v(" 配置文件：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" erueka"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("producer\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance-id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("eureka.instance.hostname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("server.port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefer-ip-address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lease-renewal-interval-in-seconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lease-expiration-duration-in-seconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8761/eureka/\n")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("bootstrap.yml")]),t._v(" 配置文件：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 日志相关配置，略。")]),t._v("\n")])])])])]),t._v(" "),s("p",[t._v("其中，"),s("strong",[t._v("spring.application.name")]),t._v(" 为该服务的名字，"),s("strong",[t._v("eureka.client.serviceUrl.defaultZone")]),t._v(" 的作用是指定注册中心的地址。")]),t._v(" "),s("p",[t._v("然后启动该工程，重新访问："),s("a",{attrs:{href:"http://localhost:8761",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("http://localhost:8761")]),s("OutboundLink")],1),t._v("，即可看到如下界面:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/spring-cloud/img/produer-1.png",alt:"producer-1"}})]),t._v(" "),s("p",[t._v("我们可以看到，刚刚创建的服务提供者 eurekaclient 已经被注册到注册中心了。")]),t._v(" "),s("p",[t._v("以上就是本文关于 Eureka 服务注册与发现的全部内容"),s("small",[t._v("（仅仅只学习上面的知识还远远不够）")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"_4-服务发现原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-服务发现原理"}},[t._v("#")]),t._v(" 4. 服务发现原理")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/spring-cloud/img/Eureka-2.png",alt:""}})]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("#")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("Application Service                               ")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("是一个 Eureka Client，扮演服务提供者的角色，提供业务服务，向 Eureka Server 注册和更新自己的信息，同时能从 Eureka Server 注册表中获取到其它服务的信息。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("Eureka Server")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("扮演服务注册中心的角色，提供服务注册和发现的功能。每个 Eureka Client 向 Eureka Server 注册自己的信息，也可以通过 Eureka Server 获取到其它服务的信息达到发现和调用其它服务的目的。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("Application Client")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("是一个 Eureka Client，扮演了服务消费者的角色，通过 Eureka Server 获取到注册到其上的其它服务的信息，从而根据信息找到所需的服务发起远程调用。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("Replicate")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Eureka Server 之间注册表信息的同步复制，使 Eureka Server 集群中不同注册表中服务实例信息保持一致。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("Make Remote Call")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("服务之间的远程调用。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("Register")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("注册服务实例")])])])]),t._v(" "),s("h2",{attrs:{id:"_5-eureka-的自我保护与健康检查"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-eureka-的自我保护与健康检查"}},[t._v("#")]),t._v(" 5. Eureka 的自我保护与健康检查")]),t._v(" "),s("p",[t._v("在 Eureka Server 的各个服务的 Status 栏显示着 "),s("strong",[t._v("UP")]),t._v(" ，表示该服务及其多实例处于状态正常。其它取值 "),s("strong",[t._v("DOWN")]),t._v(" 、"),s("strong",[t._v("OUT_OF_SERVICE")]),t._v(" 、"),s("strong",[t._v("UNKNOWN")]),t._v(" 等均表示该服务处于不可被请求的状态，只有 "),s("strong",[t._v("UP")]),t._v(" 状态的微服务会被请求。")]),t._v(" "),s("p",[t._v("Eureka Server 与 Eureka Client 之间使用『"),s("strong",[t._v("心跳机制")]),t._v("』来确定Eureka Client（微服务实例）的状态。")]),t._v(" "),s("p",[t._v("在 Eureka Client 端，有 2 个配置与这个『心跳机制』有关：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Eureka Client 配置")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lease-renewal-interval-in-seconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认值")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lease-expiration-duration-in-seconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认值")]),t._v("\n")])])]),s("ul",[s("li",[s("p",[s("strong",[t._v("lease-renewal-interval-in-seconds")]),t._v(" ：表示每间隔 N 秒，Client 向 Server 发送一次心跳，以证明自己"),s("small",[t._v("（Client）")]),t._v("还存活。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("lease-expiration-duration-in-seconds")]),t._v(" ：是 Client 端告知 Server，如果"),s("small",[t._v("（未来）")]),t._v("我"),s("small",[t._v("（Client）")]),t._v("在连续的 N 秒内没有给你"),s("small",[t._v("（Server）")]),t._v("发心跳，就代表我"),s("small",[t._v("（Client）")]),t._v("“死”了，请你"),s("small",[t._v("（Server）")]),t._v("将我"),s("small",[t._v("（Client）")]),t._v("踢除。")])])]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("Eureka Client 通过心跳机制向 Eureka Server 证明自己的存活状态，但是，一旦 Eureka Client 挂掉了，超过了 Client 自己所声明的最长上报时间，Eureka Server 也不是实时将其移除。")]),t._v(" "),s("p",[t._v("Eureka Server 每间隔一段时间时间『集中』清理无效的客户端，这个配置是 Server 端的：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Eureka Server 配置")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eviction-interval-timer-in-ms")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认值，单位毫秒")]),t._v("\n")])])]),s("br"),t._v(" "),s("hr"),t._v(" "),s("br"),t._v(" "),s("p",[t._v("Eureka Server 发现 Client 没给它"),s("small",[t._v("（Server）")]),t._v("发送心跳，不一定是 Client 出现了问题，也有可能是 Eureka Server 自己掉线了。")]),t._v(" "),s("p",[t._v("默认情况下，如果在 "),s("strong",[t._v("15")]),t._v(" 分钟内超过 "),s("strong",[t._v("85%")]),t._v(" 的客户端节点都没有正常的心跳，那么 Eureka 就认为这些客户端与注册中心出现了网络故障"),s("small",[t._v("（比如网络故障或频繁的启动关闭客户端）")]),t._v("，Eureka Server自动进入『"),s("strong",[t._v("自我保护模式")]),t._v("』。")]),t._v(" "),s("p",[t._v("和这个概念有关的配置是：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Eureka Server 配置")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enable-self-preservation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("renewal-threshold-update-interval-ms")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 15 * 60 * 1000\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("renewal-percent-threshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.85")]),t._v("\n")])])]),s("p",[t._v("Eureka Server 一旦认为是自己出了问题，从而开启保护模式后，就不再将失效的服务从列表中剔除。当网络故障恢复后，Eureka Server 会自动退出自我保护模式。")]),t._v(" "),s("p",[t._v("在开发和测试环境中，由于我们会经常性地、频繁地启停服务，导致心跳消失，因此我们通常会将 Eureka Server 的『"),s("strong",[t._v("自我保护模式")]),t._v("』关闭掉，以避免它触发进入保护模式，从而导致改下线的服务没有下线。")]),t._v(" "),s("p",[t._v("关闭自我保护模式，需要在服务端和客户端配置：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务端配置")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1. 关闭自我保护模式。（新版本中官方不建议关闭，会有告警）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2. 缩短清理周期。（其实默认值也行）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enable-self-preservation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eviction-interval-timer-in-ms")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 客户端配置：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1. 缩短心跳上报周期")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2. 缩短有效期时长")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lease-renewal-interval-in-seconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lease-expiration-duration-in-seconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("\n")])])]),s("h2",{attrs:{id:"_6-eureka-集群服务注册-了解、自学"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-eureka-集群服务注册-了解、自学"}},[t._v("#")]),t._v(" 6. Eureka 集群服务注册（了解、自学）")]),t._v(" "),s("p",[t._v("服务注册中心在整个微服务体系中，至关重要！如果服务注册中心挂了，整个系统都将崩溃。所以服务注册中心通常不会被部署为单点应用，而是采用集群的部署方式，其中个别节点挂掉不影响整个系统的运行。")]),t._v(" "),s("p",[t._v("假设：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("注册中心")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("IP 地址")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("peer-1")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("192.168.1.110")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("peer-2")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("192.168.1.111")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("peer-3")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("192.168.1.112")])])])]),t._v(" "),s("p",[t._v("关键配置在于：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("在 eureka 集群搭建过程中，"),s("strong",[t._v("fetch-registry")]),t._v(" 和 "),s("strong",[t._v("register-with-eureka")]),t._v(" 一定设置为 true 。表示从其他 2 个实例同步服务注册信息，并且向其他的 2 个 Server 注册自己。")])]),t._v(" "),s("li",[s("p",[t._v("将 peer-1 的 defaultZone 设置为 peer-2 和 peer-3 。")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" eureka"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8761")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.1.110\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("health-check-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("eureka.instance.hostname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("server.port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/actuator/health\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fetch-registry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("register-with-eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//192.168.1.111"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8761/eureka/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//192.168.1.112"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8761/eureka/\n")])])]),s("p",[t._v("另外两个 Server 的配置反之亦然。")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-actuator"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h2",{attrs:{id:"_7-config-properties"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-config-properties"}},[t._v("#")]),t._v(" 7. config.properties")]),t._v(" "),s("p",[t._v("在注册中心启动过程中，你会看到日志信息中有这样的 WARN 日志：")]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("No URLs will be polled as dynamic configuration sources\n")])])]),s("p",[t._v("这里的原因在于我们的项目间接引用到了 "),s("strong",[t._v("spring-cloud-starter-netflix-archaius")]),t._v(" 包。虽然，我们没有用到它，但是这个包既然在我们项目中，那么它就会『"),s("strong",[t._v("期望")]),t._v("』我们项目的 resources 目录下有一个名为 "),s("strong",[t._v("config.properties")]),t._v(" 的配置文件"),s("small",[t._v("（其中放它要用到的配置文件）")]),t._v("。")]),t._v(" "),s("p",[t._v("由于实际上我们并没由于用到这个包，所以，你可以将这个包移除。或者在 "),s("strong",[t._v("resources")]),t._v(" 目录下创建一个空的 "),s("strong",[t._v("config.properties")]),t._v(" 文件。")]),t._v(" "),s("h2",{attrs:{id:"_8-gist"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-gist"}},[t._v("#")]),t._v(" 8. Gist")]),t._v(" "),s("h3",{attrs:{id:"eureka-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eureka-server"}},[t._v("#")]),t._v(" Eureka Server")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("application.yml")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8761")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" eureka"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("spring.cloud.client.ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("address"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instanceId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("eureka.instance.hostname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("server.port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefer-ip-address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fetchRegistry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("registerWithEureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceUrl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("server.port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/eureka\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enable-self-preservation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eviction-interval-timer-in-ms")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认值，单位毫秒")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("logging")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("root")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" WARN\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("com.woniu")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" debug\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("com.example")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" debug\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' "$'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("CONSOLE_LOG_PATTERN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\\n        "),s("span",{pre:!0,attrs:{class:"token directive important"}},[t._v("%clr(${LOG_LEVEL_PATTERN:%5p}) \\")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive important"}},[t._v("%clr([%15.15t]){faint} \\")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive important"}},[t._v("%clr(%-40.40logger{39}){cyan} \\")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive important"}},[t._v("%clr(:){faint} \\")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive important"}},[t._v('%m%n${LOG_EXCEPTION_CONVERSION_WORD:%wEx}}"')]),t._v("\n")])])])])]),t._v(" "),s("h3",{attrs:{id:"eureka-client"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eureka-client"}},[t._v("#")]),t._v(" Eureka Client")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("bootstrap.yml")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance-id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("eureka.instance.hostname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("server.port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefer-ip-address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lease-renewal-interval-in-seconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lease-expiration-duration-in-seconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8761/eureka\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("management")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exposure")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#        include: refresh,health,hystrix.stream")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("health")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("show-details")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("logging")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("root")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" WARN\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' "$'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("CONSOLE_LOG_PATTERN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\\n      "),s("span",{pre:!0,attrs:{class:"token directive important"}},[t._v("%clr(${LOG_LEVEL_PATTERN:%5p}) \\")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token directive important"}},[t._v("%clr([%15.15t]){faint} \\")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token directive important"}},[t._v("%clr(%-40.40logger{39}){cyan} \\")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token directive important"}},[t._v("%clr(:){faint} \\")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token directive important"}},[t._v('%m%n${LOG_EXCEPTION_CONVERSION_WORD:%wEx}}"')]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("application.yml")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("spring.cloud.client.ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("address"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);