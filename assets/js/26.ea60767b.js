(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{394:function(s,e,t){"use strict";t.r(e);var a=t(47),n=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"docker-redis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-redis"}},[s._v("#")]),s._v(" Docker Redis")]),s._v(" "),t("p",[s._v("docker hub 网址："),t("a",{attrs:{href:"https://hub.docker.com/_/redis",target:"_blank",rel:"noopener noreferrer"}},[t("em",[s._v("https://hub.docker.com/_/redis")]),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("当前"),t("small",[s._v("（2020-04-02）")]),s._v(" "),t("strong",[s._v("latest")]),s._v(" 版本和 "),t("strong",[s._v("6.2.1")]),s._v(" 是同一个版本。")]),s._v(" "),t("h2",{attrs:{id:"_1-安装及测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装及测试"}},[s._v("#")]),s._v(" 1. 安装及测试")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询中央仓库")]),s._v("\ndocker search -f is-official"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true redis\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从中央仓库下载")]),s._v("\ndocker pull redis:6.2.1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或，直接导入已有的镜像文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker load -i redis-6.2.1.tar")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看本地镜像")]),s._v("\ndocker images\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 会出现类似以下内容：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# REPOSITORY  TAG      IMAGE ID        CREATED        SIZE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis       6.2.1    7f33e76fcb56    45 hours ago   105MB")]),s._v("\n")])])]),t("p",[s._v("运行容器：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除曾经已有的同名容器")]),s._v("\ndocker stop redis-test\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" redis-test\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建并运行 redis 容器的语法")]),s._v("\ndocker run -d --name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("指定容器名"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("指定宿主机端口"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":6379 redis:6.2.1\n")])])]),t("p",[s._v("例如：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("docker run "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   -d "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   --name redis-test "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(":6379 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   redis:6.2.1\n")])])]),t("p",[s._v("验证安装成功")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("通过 "),t("strong",[s._v("docker ps")]),s._v(" 命令查看容器的运行信息：")]),s._v(" "),t("p",[s._v("略")])]),s._v(" "),t("li",[t("p",[s._v("进入 redis-test 容器")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("docker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis-test /bin/bash\n")])])])]),s._v(" "),t("li",[t("p",[s._v("执行 "),t("code",[s._v("redis-cli")]),s._v(" 连接 redis server")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli\n")])])])])]),s._v(" "),t("p",[s._v("后续可选操作：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("设置键值对")]),s._v(" "),t("p",[s._v("连上 Redis Server 之后，执行 redis 命令："),t("code",[s._v("set test 1")]),s._v("，会显示 "),t("code",[s._v("OK")]),s._v(" 。")])]),s._v(" "),t("li",[t("p",[s._v("从容器外部连接")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -h "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("宿主机IP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("宿主机端口"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("登录密码"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])])])]),s._v(" "),t("h2",{attrs:{id:"_2-容器中的配置文件和数据的存储"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-容器中的配置文件和数据的存储"}},[s._v("#")]),s._v(" 2. 容器中的配置文件和数据的存储")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("Docker Redis Server 的数据的存储目录在容器内部的")]),s._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/data\n")])])]),t("p",[s._v("很显然，只有开启持久化功能时，才会有数据存储于此。")])]),s._v(" "),t("li",[t("p",[s._v("早期的 Docker Redis 在容器中有默认的配置文件，但现在没有了。")]),s._v(" "),t("p",[s._v("从 5 版本开始 Docker Redis 改变了思路，容器内部不在包含配置文件，而是"),t("strong",[s._v("要求容器启动时指定宿主机中的一个文件作为配置文件")]),s._v("。")]),s._v(" "),t("p",[s._v("例如：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("docker run "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("宿主机上的redis.conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":/usr/local/etc/redis/redis.conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  redis:6.2.1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  redis-server /usr/local/etc/redis/redis.conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("说明")]),s._v(" "),t("p",[s._v("当然，如果你没有提供配置文件，它还是有默认的配置的，只不过你在容器中找不到配置文件。")])]),s._v(" "),t("p",[s._v("5.0.6 的默认的配置文件的有效内容见最后。")])])]),s._v(" "),t("h2",{attrs:{id:"_3-配置与挂载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置与挂载"}},[s._v("#")]),s._v(" 3. 配置与挂载")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("删除已存在的同名容器")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f redis-6379\n")])])]),t("p",[s._v("后续可通过 "),t("em",[s._v("docker run")]),s._v(" 的 "),t("strong",[s._v("--rm")]),s._v(" 选项免去『删除』这步操作。")])]),s._v(" "),t("li",[t("p",[s._v("创建本机挂载目录")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p ~/docker/redis/6379/data\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" ~/docker/redis/6379/redis.conf\n")])])])]),s._v(" "),t("li",[t("p",[s._v("创建并运行容器")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("docker run "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   -d "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   --name redis-6379 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(":6379 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   -v ~/docker/redis/6379/redis.conf:/usr/local/etc/redis/redis.conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   -v ~/docker/redis/6379/data:/data "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   redis:6.2.1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   redis-server /usr/local/etc/redis/redis.conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   --appendonly "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" \n")])])]),t("p",[t("strong",[s._v("--appendonly yes")]),s._v(" 开启 Redis 持久化功能。")])])]),s._v(" "),t("h2",{attrs:{id:"_4-docker-compose-启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-docker-compose-启动"}},[s._v("#")]),s._v(" 4. docker-compose 启动")]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mem_limit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 512m\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"~/docker/6379/data:/data"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./docker/6379/redis.conf:/usr/local/etc/redis/redis.conf"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server /usr/local/etc/redis/redis.conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("appendonly yes\n")])])]),t("h2",{attrs:{id:"_5-redis-conf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-redis-conf"}},[s._v("#")]),s._v(" 5. redis.conf")]),s._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('bind 127.0.0.1\nprotected-mode yes\nport 6379\ntcp-backlog 511\ntimeout 0\ntcp-keepalive 300\ndaemonize no\nsupervised no\npidfile /var/run/redis_6379.pid\nloglevel notice\nlogfile ""\ndatabases 16\nalways-show-logo yes\nsave 900 1\nsave 300 10\nsave 60 10000\nstop-writes-on-bgsave-error yes\nrdbcompression yes\nrdbchecksum yes\ndbfilename dump.rdb\ndir ./\nreplica-serve-stale-data yes\nreplica-read-only yes\nrepl-diskless-sync no\nrepl-diskless-sync-delay 5\nrepl-disable-tcp-nodelay no\nreplica-priority 100\nlazyfree-lazy-eviction no\nlazyfree-lazy-expire no\nlazyfree-lazy-server-del no\nreplica-lazy-flush no\nappendonly no\nappendfilename "appendonly.aof"\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\naof-load-truncated yes\naof-use-rdb-preamble yes\nlua-time-limit 5000\nslowlog-log-slower-than 10000\nslowlog-max-len 128\nlatency-monitor-threshold 0\nnotify-keyspace-events ""\nhash-max-ziplist-entries 512\nhash-max-ziplist-value 64\nlist-max-ziplist-size -2\nlist-compress-depth 0\nset-max-intset-entries 512\nzset-max-ziplist-entries 128\nzset-max-ziplist-value 64\nhll-sparse-max-bytes 3000\nstream-node-max-bytes 4096\nstream-node-max-entries 100\nactiverehashing yes\nclient-output-buffer-limit normal 0 0 0\nclient-output-buffer-limit replica 256mb 64mb 60\nclient-output-buffer-limit pubsub 32mb 8mb 60\nhz 10\ndynamic-hz yes\naof-rewrite-incremental-fsync yes\nrdb-save-incremental-fsync yes\n')])])])])}),[],!1,null,null,null);e.default=n.exports}}]);