(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{409:function(s,t,a){"use strict";a.r(t);var e=a(47),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"ubuntu-上安装-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-上安装-docker"}},[s._v("#")]),s._v(" Ubuntu 上安装 Docker")]),s._v(" "),a("blockquote",[a("p",[s._v("以下 CentOS 的版本是 8 。另外，以下命令默认以 root 进行操作。"),a("br"),s._v("\n另外，开发环境中，简单起见，记得关闭 Linux 防火墙"),a("br")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[s._v("#")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("命令")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("查看状态")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[s._v("sudo ufw status")])])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("开启并开机启动")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[s._v("sudo ufw enable")])])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("关闭")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[s._v("sudo ufw disable")])])])])]),s._v(" "),a("p",[s._v("Ubuntu 的防火墙默认是关闭的。")])]),s._v(" "),a("h3",{attrs:{id:"前期准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前期准备工作"}},[s._v("#")]),s._v(" 前期准备工作")]),s._v(" "),a("p",[s._v("Ubuntu 的默认的 apt 软件源中实际上有 docker 的安装包，理论上来说，你直接利用默认软件源中的 docker 安装包进行安装也是可行的。")]),s._v(" "),a("p",[s._v("但是 docker 官方考虑到不同的用户对 docker 的不同版本有不同的需求"),a("small",[s._v("（有人追求最新，有人追求稳定）")]),s._v("，他们专门提供了一个仓库用以提供多个版本的 docker 的下载。")]),s._v(" "),a("p",[s._v("另外，通常 apt 默认软件源中的软件的版本并不一定是最新版。")]),s._v(" "),a("p",[s._v("因此，我们必须『告知』apt 有这样一个仓库的存在，并且未来要求 apt 从这个仓库中下载我们指定版本的 docker 。"),a("small",[s._v("而非默认的仓库。")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("查看内核版本")]),s._v(" "),a("p",[s._v("Docker 官方要求 Linux 内核版本至少 "),a("code",[s._v("3.8")]),s._v(" 以上，建议 "),a("code",[s._v("3.10")]),s._v(" 以上。Ubuntu 18.04 的内核是符合其要求的。")]),s._v(" "),a("p",[s._v("通过以下命令可查看内核版本：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -r\n")])])])]),s._v(" "),a("li",[a("p",[s._v("卸载旧版本")]),s._v(" "),a("p",[s._v("较旧的 Docker 版本称为 "),a("em",[s._v("docker")]),s._v(" 或 "),a("em",[s._v("docker-engine")]),s._v(" 。如果已安装这些程序，请卸载它们以及相关的依赖项。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" remove "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        docker "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        docker-engine "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        docker-ce "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        docker.io\n")])])])]),s._v(" "),a("li",[a("p",[s._v("为配置 docker 软件源作准备")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        apt-transport-https "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        ca-certificates "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        software-properties-common\n")])])]),a("p",[a("small",[s._v("这一步操作是为下一步操作作准备工作。")])])]),s._v(" "),a("li",[a("p",[s._v("为 apt 将要添加的 docker 软件源添加校验")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -fsSL https://download.docker.com/linux/ubuntu/gpg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" apt-key "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" -\n")])])]),a("p",[a("small",[s._v("这一步操作是为下一步操作作准备工作。")])])]),s._v(" "),a("li",[a("p",[s._v("为 apt 添加 docker 官方软件源")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" add-apt-repository "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\\n  '),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("lsb_release -cs"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(' \\\n  stable"')]),s._v("\n")])])]),a("p",[s._v("这步操作的最直观的效果就是：你的 "),a("strong",[s._v("/etc/apt/sources.list")]),s._v(" 文件中会『多出来一行』"),a("small",[s._v("（一个远程仓库的网址）")])]),s._v(" "),a("p",[s._v("记得执行以此 "),a("strong",[s._v("sudo apt update")]),s._v("，去更新『软件清单』。")])]),s._v(" "),a("li",[a("p",[s._v("验证仓库是否添加成功：查看所有仓库中所有 docker 版本")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-cache")]),s._v(" madison docker-ce\n")])])])])]),s._v(" "),a("h3",{attrs:{id:"安装-docker-并验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-docker-并验证"}},[s._v("#")]),s._v(" 安装 docker 并验证")]),s._v(" "),a("h4",{attrs:{id:"从网络仓库中下载-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从网络仓库中下载-安装"}},[s._v("#")]),s._v(" 从网络仓库中下载，安装")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  docker-ce "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  docker-ce-cli "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  containerd.io\n")])])]),a("p",[s._v("在没有指定版本的情况下，apt 下载的是软件源中的最新版。如果想要指定特定版本，则使用如下语法：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  docker-ce"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("VERSION_STRING"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  docker-ce-cli"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("VERSION_STRING"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  containerd.io\n")])])]),a("p",[s._v("带入特定版本号，例如："),a("code",[s._v("5:19.03.13~3-0~ubuntu-bionic")]),s._v(" 。")]),s._v(" "),a("h4",{attrs:{id:"启动-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动-docker"}},[s._v("#")]),s._v(" 启动 Docker")]),s._v(" "),a("p",[s._v("类似于 MySQL，"),a("strong",[s._v("Docker 也是基于 CS 架构的")]),s._v("。你的 Ubuntu 上存在一个 Docker 服务端和一个 Docker 客户端。")]),s._v(" "),a("p",[s._v("要使用 Docker 的前提是：确保 Docker 的服务端启动了。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 docker 服务端")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start docker\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 docker 服务端设置为开机启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker\n")])])]),a("h4",{attrs:{id:"验证安装是否成功"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证安装是否成功"}},[s._v("#")]),s._v(" 验证安装是否成功")]),s._v(" "),a("p",[s._v("Docker 是 CS 架构的，"),a("strong",[s._v("docker 的服务端是以 docker 用户")]),a("small",[s._v("（属于 docker 用户组）")]),s._v("身份运行的，因此你去执行 docker 命令时，你的身份"),a("small",[s._v("（和权限）")]),s._v("是不符合的。")]),s._v(" "),a("p",[s._v("当你通过 "),a("strong",[s._v("docker version")]),s._v(" 命令去验证安装是否成功时，会出现如下信息：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("Got permission denied "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" trying to connect to the Docker daemon socket "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" connect: permission denied\n")])])]),a("p",[a("small",[s._v("有 client 和 server 两部分表示 docker 安装启动都成功了。")])]),s._v(" "),a("p",[s._v("解决办法有 2 个：")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("你所执行的所有的 docker 命令前面都加上 "),a("strong",[s._v("sudo")]),s._v(" 。将你的身份临时提升为 root，root 自然是有权限执行 docker 命令的。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker version\n")])])])]),s._v(" "),a("li",[a("p",[s._v("将你自己添加到 docker 用户组中。你和 docker 用户所属同一个用户组，你的自然就有权限执行 docker 命令。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建名为 docker 的用户组。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正常情况下，这条命令的结果会告诉你 docker 用户组已存在。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" docker \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将当前用户（即你所登录系统的账号）添加至 docker 用户组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" gpasswd -a "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$USER")]),s._v(" docker \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新 docker 用户组")]),s._v("\nnewgrp docker \n")])])])])]),s._v(" "),a("h4",{attrs:{id:"验证连接-docker-hub-中央镜像仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证连接-docker-hub-中央镜像仓库"}},[s._v("#")]),s._v(" 验证连接 docker hub 中央镜像仓库")]),s._v(" "),a("p",[s._v("输入 "),a("code",[s._v("docker search -f is-official=true mysql")]),s._v(" 命令，会出现类似如下结果：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("NAME     DESCRIPTION                                     STARS  OFFICIAL "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nmysql    MySQL is a widely used, open-source relation…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8819")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nmariadb  MariaDB is a community-developed fork of MyS…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3102")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\npercona  Percona Server is a fork of the MySQL relati…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("459")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),a("h3",{attrs:{id:"配置国内镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置国内镜像"}},[s._v("#")]),s._v(" 配置国内镜像")]),s._v(" "),a("p",[s._v("由于 docker hub 的中央镜像仓库在国外，因此有时我们连接 docker hub 从中下载镜像速度会很感人，因此，我们需要配置国内的镜像网址，从国内现在镜像文件。")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("国内的镜像本质上就是 docker hub 中央仓库在国内的一份缓存/备份。")])]),s._v(" "),a("p",[s._v("通过 vi 命令编辑相关配置文件：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/docker/daemon.json \n")])])]),a("p",[s._v("如果该文件存在，则将其内容清除；如果文件不存在，"),a("small",[s._v("（打开该文件后，其内容是空白的），")]),s._v("编辑结束后保存退出，即创建。")]),s._v(" "),a("p",[s._v("输入如下内容：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://registry.docker-cn.com"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://docker.mirrors.ustc.edu.cn"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[a("small",[s._v("该配置文件配置了两个镜像，一个是 docker 官方在中国境内的官方镜像，一个是中科大维护的一个镜像。")])]),s._v(" "),a("p",[s._v("重新启动 docker 服务：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart docker\n")])])]),a("p",[s._v("查看修改结果：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("docker info\n")])])]),a("p",[s._v("会有如下内容：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("...\nRegistry Mirrors:\n https://registry.docker-cn.com/\n https://docker.mirrors.ustc.edu.cn/\n...\n")])])]),a("h3",{attrs:{id:"导入已有的镜像文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导入已有的镜像文件"}},[s._v("#")]),s._v(" 导入已有的镜像文件")]),s._v(" "),a("p",[s._v("考虑到有些场景下的联网的不方便，docker 提供了将已下载的 images 打包导出，再在别处导入的功能。")]),s._v(" "),a("p",[s._v("导出已有 image 使用命令：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("docker save "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("repository"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" -o "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("repository"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(".tar\n")])])]),a("p",[s._v("例如：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("docker save mysql:8.0.16 -o mysql-8.0.16.tar\n")])])]),a("p",[s._v("导入 image 使用命令：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("docker load -i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("repository"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(".tar\n")])])]),a("p",[s._v("例如：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("docker load -i mysql-8.0.16.tar\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);