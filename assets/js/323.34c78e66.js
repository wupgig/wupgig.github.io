(window.webpackJsonp=window.webpackJsonp||[]).push([[323],{691:function(t,s,a){"use strict";a.r(s);var n=a(47),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"在-sprig-boot-简单整合-spring-security"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-sprig-boot-简单整合-spring-security"}},[t._v("#")]),t._v(" 在 Sprig Boot 简单整合 Spring Security")]),t._v(" "),a("h2",{attrs:{id:"_0-shiro-和-spring-security-类比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0-shiro-和-spring-security-类比"}},[t._v("#")]),t._v(" 0. Shiro 和 Spring Security 类比")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"right"}},[t._v("Shiro")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Spring Security")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"right"}},[t._v("SecurityManager")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("AuthenticationManager / ProviderManager")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"right"}},[t._v("Authenticator "),a("br"),t._v(" Authorizer")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("AuthenticationProvider")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"right"}},[t._v("Realm"),a("br"),t._v("SimpleAccountRealm"),a("br"),t._v("JdbcRealm")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("UserDetailService 接口"),a("br"),t._v("InMemoryUserDetailsManager 类"),a("br"),t._v("JdbcDaoImpl 类")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"right"}},[t._v("AuthenticationInfo"),a("br"),t._v("AuthorizationInfo")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("UserDetails 接口 "),a("br"),t._v(" User 类")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"right"}},[t._v("CredentialsMatcher")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PasswordEncoder")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"right"}},[t._v("Subject")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Authentication")])])])]),t._v(" "),a("h2",{attrs:{id:"_1-hello-world"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-hello-world"}},[t._v("#")]),t._v(" 1. Hello World")]),t._v(" "),a("p",[t._v("创建一个 Spring Boot 应用，并引入依赖：")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-security"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("编写一个控制器：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RestController")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestController")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello SpringSecurity!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("然后直接启动项目，访问 "),a("a",{attrs:{href:"http://localhost:8080/login",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost:8080/login"),a("OutboundLink")],1),t._v("：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/spring-security/img/spring-boot-security-helloworld-01.png",alt:"spring-boot-security-helloworld-01"}})]),t._v(" "),a("p",[t._v("结果打开的是一个登录页面，其实这时候我们的请求已经被保护起来了，要想访问，需要先登录。")]),t._v(" "),a("p",[t._v("在这个案例中仅仅是引入了一个 Spring Security 的 starter 启动器，没有做任何的配置，而项目已经具有了权限认证。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/spring-security/img/spring-boot-security-helloworld-02.png",alt:"spring-boot-security-helloworld-02"}})]),t._v(" "),a("p",[t._v("Spring Security 默认提供了一个用户名为 "),a("strong",[t._v("user")]),t._v(" 的用户，其密码在控制台可以找到：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/spring-security/img/spring-boot-security-helloworld-03.png",alt:"spring-boot-security-helloworld-03"}})]),t._v(" "),a("p",[t._v("成功登录以后就可以正常访问了：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/spring-security/img/spring-boot-security-helloworld-04.png",alt:"spring-boot-security-helloworld-04"}})]),t._v(" "),a("p",[t._v("如果想要想修改配置，则应使用 "),a("code",[t._v("spring.security.user.name")]),t._v(" 和 "),a("code",[t._v("spring.security.user.password")]),t._v(" 。")]),t._v(" "),a("p",[t._v("在 Spring Boot 的配置文件中进行如下配置：")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.security.user.name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("tom")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.security.user.password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("123")]),t._v("\n")])])]),a("p",[t._v("此时启动项目，将只能通过自己配置的用户名和密码登录。")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("当然还可以通过配置类的方式进行配置，创建一个配置类去继承 "),a("strong",[t._v("WebSecurityConfigurerAdapter")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 未来会变成 @EnableWebSecurity")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityConfig")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSecurityConfigurerAdapter")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("configure")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AuthenticationManagerBuilder")]),t._v(" auth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对密码进行加密。123 是密码明文，现在 Spring Security 强制性不允许明文存储密码。")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BCryptPasswordEncoder")]),t._v(" passwordEncoder "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BCryptPasswordEncoder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" password "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" passwordEncoder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("encode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        auth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("inMemoryAuthentication")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tom"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("roles")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("从 5.x 开始，强制性要求必须使用密码加密器"),a("small",[t._v("（PasswordEncode‏）")]),t._v("对原始密码"),a("small",[t._v("（注册密码）")]),t._v("进行加密。")]),t._v(" "),a("p",[t._v("因此，如果忘记指定 PasswordEncoder 会导致执行时会出现 "),a("code",[t._v('There is no PasswordEncoder mapped for the id "null"')]),t._v(" 异常。")]),t._v(" "),a("p",[t._v("Shiro 没有这个强制要求，CredentialsMatcher 你可用可不用。")])]),t._v(" "),a("p",[t._v("重新启动项目测试一下。会发现登录不上，观察控制台：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/spring-security/img/spring-boot-security-helloworld-07.png",alt:"spring-boot-security-helloworld-07"}})]),t._v(" "),a("p",[t._v("这是因为我们在对密码加密的时候使用到了 "),a("strong",[t._v("BCryptPasswordEncoder")]),t._v(" 对象，而 Spring Security 在对密码比对的过程中不会『自己创建』加密器，因此，需要我们在 Spring IoC 容器中配置、创建好加密器的单例对象，以供它直接使用。")]),t._v(" "),a("p",[t._v("所以，我们还需要在容器中配置、创建加密器的单例对象"),a("small",[t._v("（上面那个 new 理论上可以改造成注入）")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PasswordEncoder")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("passwordEncoder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BCryptPasswordEncoder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("再次重新启动一切正常。")]),t._v(" "),a("h2",{attrs:{id:"_2-password-encoder"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-password-encoder"}},[t._v("#")]),t._v(" 2. Password Encoder")]),t._v(" "),a("p",[t._v("之前有提及，Spring Security 升级到 "),a("code",[t._v("5")]),t._v(" 版本后提高了安全要求：Spring Security 要求所有的密码的存储都『"),a("strong",[t._v("必须")]),t._v("』是加密形式的。为此，我们必须要确保 Spring IoC 容器中有一个了 "),a("strong",[t._v("PasswordEncoder")]),t._v(" 的单例对象用以供 Spring Security 使用。")]),t._v(" "),a("p",[t._v("PasswordEncoder 在两处场景会被使用到：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("当我们实现注册功能时，要将用户在前端页面输入的明文密码使用 PasswordEncoder 进行加密后存储、持久化。")])]),t._v(" "),a("li",[a("p",[t._v("当用户在登录时，Spring Security 会将用户在前端页面输入的明文密码使用 PasswordEncoder 进行加密之后，再和由我们提供的密码『标准答案』进行比对。")])])]),t._v(" "),a("p",[t._v("Spring Security 使用 "),a("strong",[t._v("PasswordEncoder")]),t._v(" 对你提供的密码进行加密。该接口中有两个方法：加密方法，是否匹配方法。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("加密方法"),a("small",[t._v("（"),a("strong",[t._v("encode")]),t._v("）")]),t._v("方法在用户注册时使用。在注册功能处，我们"),a("small",[t._v("（程序员）")]),t._v("需要将用户提供的密码加密后存储"),a("small",[t._v("（至数据库）")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("匹配方法 "),a("strong",[t._v("matches")]),t._v(" 方法是由 Spring Security 调用的。在登录功能处，Spring Security 要用它来比较登录密码和密码『标准答案』。")])])]),t._v(" "),a("p",[t._v("因此上面的配置改为如下形式更为合理：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Slf4j")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 未来会变成 @EnableWebSecurity")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityConfig")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSecurityConfigurerAdapter")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PasswordEncoder")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("passwordEncoder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BCryptPasswordEncoder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("configure")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AuthenticationManagerBuilder")]),t._v(" auth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" password "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("passwordEncoder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("encode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        auth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("inMemoryAuthentication")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tom"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("roles")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Spring Security 内置的 Password Encoder 有：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("加密算法名称")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("PasswordEncoder")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("NOOP")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("NoOpPasswordEncoder.getInstance()")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("SHA256")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("new StandardPasswordEncoder()")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("BCRYPT"),a("small",[t._v("（官方推荐）")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("new BCryptPasswordEncoder()")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("LDAP")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("new LdapShaPasswordEncoder()")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("PBKDF2")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("new Pbkdf2PasswordEncoder()")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("SCRYPT")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("new SCryptPasswordEncoder()")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("MD4")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("new Md4PasswordEncoder()")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("MD5")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('new MessageDigestPasswordEncoder("MD5")')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("SHA_1")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('new MessageDigestPasswordEncoder("SHA-1")')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("SHA_256")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('new MessageDigestPasswordEncoder("SHA-256")')])])])]),t._v(" "),a("p",[t._v("上述 Password Encoder 中有一个『无意义』的加密器："),a("strong",[t._v("NoOpPasswordEncoder")]),t._v(" 。它对原始密码没有做任何处理"),a("small",[t._v("（现在也被标记为废弃）")]),t._v("。")]),t._v(" "),a("blockquote",[a("p",[t._v('记得使用 @SuppressWarnings("deprecation") 去掉 IDE 的警告信息。')])]),t._v(" "),a("h2",{attrs:{id:"_3-消失-的登录功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-消失-的登录功能"}},[t._v("#")]),t._v(" 3. “消失”的登录功能")]),t._v(" "),a("p",[t._v("不知道大家有没有注意到，其实，我们的 Controller 中还没有写登录功能（这和 Shiro 非常不同）。但是，之前的示例中，就已经有了完整的『登录』（甚至『退出』）功能，并且，Spring Security 似乎还能记住我们已经登陆过"),a("small",[t._v("（当我们第二次访问页面时，它不会要求我们再次登录）")]),t._v("！")])])}),[],!1,null,null,null);s.default=e.exports}}]);