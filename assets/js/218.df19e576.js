(window.webpackJsonp=window.webpackJsonp||[]).push([[218],{586:function(t,a,s){"use strict";s.r(a);var n=s(47),p=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"基于-nignx-的前后端分离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于-nignx-的前后端分离"}},[t._v("#")]),t._v(" 基于 Nignx 的前后端分离")]),t._v(" "),s("h2",{attrs:{id:"反向代理服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#反向代理服务器"}},[t._v("#")]),t._v(" 反向代理服务器")]),t._v(" "),s("h3",{attrs:{id:"概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[t._v("#")]),t._v(" 概念")]),t._v(" "),s("p",[t._v("由于请求的方向是从客户端发往服务端，因此 "),s("code",[t._v("客户端 -> 服务端")]),t._v(" 这个方向是『正向』。")]),t._v(" "),s("p",[t._v("所谓『反向代理服务器』指的就是：Nginx『站』在服务端的角度，分担了服务端的负担，增强了服务端的能力。")]),t._v(" "),s("blockquote",[s("p",[t._v("在这种情况下，在客户端看来，"),s("code",[t._v("Nginx")]),t._v(" + "),s("code",[t._v("服务端")]),t._v(" 整体扮演了一个更大意义上的服务端的概念。")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/nginx/img/nginx-01.png",alt:"nginx-01"}})]),t._v(" "),s("h3",{attrs:{id:"基于-nginx-的动静分离方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于-nginx-的动静分离方案"}},[t._v("#")]),t._v(" 基于 Nginx 的动静分离方案")]),t._v(" "),s("p",[t._v("对 Nginx 的最简单的使用是将它用作静态资源服务器。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/nginx/img/nginx-02.png",alt:"nginx-02"}})]),t._v(" "),s("p",[t._v("在这种方案种，将 "),s("code",[t._v(".html")]),t._v("、"),s("code",[t._v(".css")]),t._v("、"),s("code",[t._v(".js")]),t._v("、"),s("code",[t._v(".png")]),t._v(" 等静态资源放置在 Nginx 服务器上。")]),t._v(" "),s("p",[t._v("将对静态资源的访问流量就分流到了 Nginx 服务器上，从而减轻 Servlet 容器的访问压力。")]),t._v(" "),s("h3",{attrs:{id:"基于-nginx-的前后端分离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于-nginx-的前后端分离"}},[t._v("#")]),t._v(" 基于 Nginx 的前后端分离")]),t._v(" "),s("p",[t._v("随着前端单页应用技术的发展，『前端』从简单的『前端页面』演进成了『前端项目』。")]),t._v(" "),s("p",[t._v("这种情况下，在动静分离方案的基础上进一步延伸出了『更激进』的方案：前后端分离。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/nginx/img/nginx-03.png",alt:"nginx-03"}})]),t._v(" "),s("h3",{attrs:{id:"实现原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现原理"}},[t._v("#")]),t._v(" 实现原理")]),t._v(" "),s("p",[t._v("要实现前后端分离"),s("small",[t._v("（涵盖动静分离）")]),t._v("，这里需要 Nginx 能提供一种能力：请求转发。")]),t._v(" "),s("p",[t._v("在整个过程中，所有的请求首先都是『交到了 Nginx 手里』，有一部分 请求是 Nginx 自己能响应的，它就响应了；而另一部分请求则是被 Nginx 转给了 SpringBoot，而等到 Nginx 获得到 SpringBoot 的 JSON 的返回之后，Nginx 再将响应数据回复给客户端。")]),t._v(" "),s("h2",{attrs:{id:"nginx-代理配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-代理配置"}},[t._v("#")]),t._v(" Nginx 代理配置")]),t._v(" "),s("blockquote",[s("p",[t._v("所谓『代理』指的就是 Nginx『帮』真正的服务端所接收的请求，那么也就意味着这样的请求，Nginx 最终需要再交给真正的服务端去处理。")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("http {\n    ...\n    server {\n        listen       80;\n        server_name  localhost;\n        ...\n        location /api { # 看这里，看这里，看这里\n            proxy_pass http://127.0.0.1:8080/api;\n        }\n        ...\n    }\n    ...\n}\n")])])]),s("p",[t._v("这里的关键配置在于 "),s("strong",[t._v("proxy_pass")]),t._v(" 。")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("客户端所有以 "),s("code",[t._v("http://localhost:80")]),t._v(" 开始的 URL 都会访问到 Nginx 。")]),t._v(" "),s("p",[t._v("这和我们使用 Tomcat 时类似。 例如：")]),t._v(" "),s("p",[t._v("当你访问 "),s("code",[t._v("http://localhost:80/department/main.html")]),t._v(" 时，这代表着你向 Nginx 请求一个 html 页面，"),s("small",[t._v("（结合其它相关配置）")]),t._v("如果 Nginx 服务器上有的话，它会将这个 html 页面回复给你。")])]),t._v(" "),s("li",[s("p",[t._v("客户端所有发往 Nginx 的请求中，URI 以 "),s("code",[t._v("/api")]),t._v(" 开头的请求都是 Nginx『帮』别人收的。")]),t._v(" "),s("p",[t._v("所有 URI 以 "),s("code",[t._v("/api")]),t._v("开头的请求都会被 Nginx 转给 "),s("code",[t._v("http://127.0.0.1:8080/api")]),t._v(" 地址并等待它的回复。")]),t._v(" "),s("p",[t._v("例如，你所发出的 "),s("code",[t._v("http://localhost:80/api/departments/9527")]),t._v("，会被 Nginx 发往 "),s("code",[t._v("http://127.0.0.1:8080/api/departments/9527")]),t._v(" 。")])])]),t._v(" "),s("p",[s("strong",[t._v("Nginx 的转发配置规则")])]),t._v(" "),s("ol",[s("li",[s("p",[t._v("无论如何配置你配置 "),s("code",[t._v("proxy_pass")]),t._v(" 的内容最后一定会『完全地』包含在转发、去往的路径中。")])]),t._v(" "),s("li",[s("p",[t._v("转发的规则和 "),s("code",[t._v("proxy_pass")]),t._v(" 减去 "),s("code",[t._v("http://ip:port")]),t._v(" 之后还有没与内容有关。最少的『"),s("strong",[t._v("有内容")]),t._v("』的情况是仅有一个 "),s("code",[t._v("/")]),t._v(" 。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("如果『有内容』（哪怕只有一个 "),s("code",[t._v("/")]),t._v("），转发路径是 "),s("code",[t._v("proxy_pass")]),t._v(" + ("),s("code",[t._v("path")]),t._v(" - "),s("code",[t._v("location")]),t._v(")")])]),t._v(" "),s("li",[s("p",[t._v("如果『没内容』，转发路径就是 "),s("code",[t._v("proxy_pass")]),t._v(" + "),s("code",[t._v("path")])])])])]),t._v(" "),s("li",[s("p",[t._v("location 是否以 "),s("code",[t._v("/")]),t._v(" 结尾问题不大，因为 Nginx 会认为 "),s("code",[t._v("/")]),t._v(" 本身就是 location 的内容本身（的一部分）。")])])]),t._v(" "),s("p",[t._v("一个完整的 http 配置片段"),s("small",[t._v("（其中绝大多数内容都是默认配置）")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("error_log  logs/error.log  info;    # 打开错误日志的 INFO 级别，方便观察错误信息。\n...\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;  # TCP 连接存活 65 秒\n    server {\n        # Nginx 监听 localhost:80 端口\n        listen       80;\n        server_name  localhost;\n\n        # 访问 URI 根路径时，返回 Nginx 根目录下的 html 目录下的 index.html 或 index.htm\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n\n        # URI 路径以 /api 开头的将转交给『别人』处理\n        location /api {\n            proxy_pass http://localhost:8080/api;\n        }\n\n        # 出现 500、502、503、504 错误时，返回 Nginx 根目录下的 html 目录下的 50x.html 。\n        error_page   500 502 503 504  /50x.html;    \n        location = /50x.html {\n            root   html;\n        }\n    }\n}\n")])])]),s("h2",{attrs:{id:"nginx-用于动静分离-了解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-用于动静分离-了解"}},[t._v("#")]),t._v(" Nginx 用于动静分离（了解）")]),t._v(" "),s("p",[t._v("为了显示明显的效果，准备两台独立的服务器：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Spring Boot"),s("small",[t._v("（Thymeleaf）")]),t._v("服务器。IP 地址为 "),s("code",[t._v("81.68.200.174")]),t._v(" 。")])]),t._v(" "),s("li",[s("p",[t._v("在本机"),s("small",[t._v("（127.0.0.1）")]),t._v("上运行 Nginx 。")])])]),t._v(" "),s("h3",{attrs:{id:"spring-boot-项目的内容和配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring-boot-项目的内容和配置"}},[t._v("#")]),t._v(" Spring Boot 项目的内容和配置")]),t._v(" "),s("p",[t._v("SpringBoot 项目中提供动态的 thymeleaf 页面"),s("small",[t._v("（这是动态页面，位于 template 目录下）")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token doctype"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),s("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("th")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.thymeleaf.org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Hello"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/js/jquery-1.11.3.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/javascript"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}},[s("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'h2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello world'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  ")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("th:")]),t._v("text")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("${message}"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Hello World"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("thymeleaf 页面引用并使用了 jQuery，但是我们将项目中的 "),s("code",[t._v("static")]),t._v(" 目录整体删除。即，Spring Boot 项目中并没有 "),s("code",[t._v("jquery-1.11.3.js")]),t._v(" 文件。")]),t._v(" "),s("p",[t._v("Spring Boot 项目代码：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/api/welcome-page"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("welcome")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Model")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addAttribute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://www.baidu.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"welcome"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("直接运行并访问该 Spring Boot 项目，毫无疑问，你看不要页面上的 hello world 。")])]),t._v(" "),s("h3",{attrs:{id:"nginx-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置"}},[t._v("#")]),t._v(" Nginx 配置")]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("location .*\\.js$ {\n    root    html/js;\n    expires      30d;\n}\n\nlocation /api {\n    proxy_pass http://81.68.200.174:8080/api;\n}\n")])])]),s("p",[t._v("Nginx 的配置主要就是两个：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("拦截以 "),s("code",[t._v(".js")]),t._v(" 作为后缀的请求，并到指定的目录下查找、返回 "),s("code",[t._v(".js")]),t._v(" 文件。")])]),t._v(" "),s("li",[s("p",[t._v("将接收到的以 "),s("code",[t._v("/api")]),t._v(" 开始的请求，转向到 "),s("code",[t._v("81.68.200.174:8080")]),t._v(" 。")])])]),t._v(" "),s("p",[t._v("配置正确的情况下，通过 "),s("code",[t._v("http://127.0.0.1/api/welcome-page")]),t._v(" 向 Nginx 发出请求，你看到页面，并且能够看到页面上的 "),s("code",[t._v("hello world")]),t._v(" 。")]),t._v(" "),s("h2",{attrs:{id:"前后端分离及跨域问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前后端分离及跨域问题"}},[t._v("#")]),t._v(" 前后端分离及跨域问题")]),t._v(" "),s("blockquote",[s("p",[t._v("动静分离再『向前多走一步』，就是前后端分离。上例中的 Spring Boot 不提供任何动态页面、资源，只提供 JSON 格式数据。")])]),t._v(" "),s("p",[t._v("将上例的 index.html 改造成如下形似：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("./js/jquery-1.11.3.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/javascript"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}},[s("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ajax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  url"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:80/api/hello'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注意这里的 URL")]),t._v("\n  type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("result")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"h2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"跨域访问成功:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"h2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"跨域失败!!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("再在 nginx 的 proxy_pass 配置成它所代理的 SpringBoot 的真实访问路径。例如：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("api "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass http"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    # proxy_set_header Host $http_host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    # proxy_set_header "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("X")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Real"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IP")]),t._v(" $remote_addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    # proxy_set_header "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("X")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Forwarded"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("For $proxy_add_x_forwarded_for"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("简单起见，我们这里的 Spring Boot 就运行在本地，并占用 8080 端口。")]),t._v(" "),s("p",[t._v("在结合上述的配置，意味着我们在页面发起的 "),s("code",[t._v("http://127.0.0.1:80/api/hello")]),t._v(" 的请求，被 Nginx 接收后，Nginx 会『帮』我们去访问 "),s("code",[t._v("http://127.0.0.1:8080")]),t._v(" 的 "),s("code",[t._v("/api/hello")]),t._v("，并将结果再返回给客户端了浏览器。")]),t._v(" "),s("p",[t._v("在这个过程中，客户端浏览器始终面对的都是 Nginx，因此，请求页面的 "),s("code",[t._v("index.html")]),t._v(" 和 AJAX 请求 "),s("code",[t._v("/api/hello")]),t._v(" 都是发往了同一个服务器，自然就没有跨域问题。")])])}),[],!1,null,null,null);a.default=p.exports}}]);