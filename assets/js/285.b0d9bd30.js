(window.webpackJsonp=window.webpackJsonp||[]).push([[285],{653:function(a,s,t){"use strict";t.r(s);var n=t(47),e=Object(n.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"alibaba-nacos-配置中心"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#alibaba-nacos-配置中心"}},[a._v("#")]),a._v(" Alibaba Nacos：配置中心")]),a._v(" "),t("p",[a._v("Nacos 是 Alibaba 开发的是用于微服务管理的平台，其核心功能是服务注册与发现、集中配置管理。")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("Nacos 作为服务注册发现组件，可以替换 Spring Cloud 应用中传统的服务注册于发现组件，如：Eureka、Consul 等，支持服务的健康检查。")])]),a._v(" "),t("li",[t("p",[a._v("Nacos 作为服务配置中心，可以替换 Spring Cloud Config、Apollo 等。")])])]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("说明")]),a._v(" "),t("p",[a._v("为什么叫 Nacos？Naming 与 Configuration 的前两个字母的组合，最后的 s 代表 service 。从其命名也能看出其核心功能。")])]),a._v(" "),t("p",[a._v("Nacos 作为配置管理中心，实现的核心功能就是配置的统一管理。")]),a._v(" "),t("div",{staticClass:"language-xml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.alibaba.cloud"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-alibaba-nacos-config"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),t("h2",{attrs:{id:"_1-连接和使用配置中心"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-连接和使用配置中心"}},[a._v("#")]),a._v(" 1. 连接和使用配置中心")]),a._v(" "),t("p",[a._v("新建配置文件 "),t("strong",[a._v("bootstrap.yml")]),a._v(" ，新增 "),t("strong",[a._v("spring.cloud.nacos.config")]),a._v(" 段配置，将服务指向正确的 nacos 服务端。该配置文件中只保留 nacos 相关的配置即可，其他的配置放到 nacos 中统一管理。")]),a._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),t("p",[a._v("和 Spring Cloud Config 一样，连接配置中心的配置『"),t("strong",[a._v("必须")]),a._v("』写在 "),t("strong",[a._v("bootstrap")]),a._v(" 配置文件中，"),t("small",[a._v("而不是 application 配置文件中")]),a._v("。")])]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("service\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 127.0.0.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("config")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("spring.cloud.nacos.discovery.server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("file-extension")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" yaml   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# nacos 配置文件后缀。注意是 yaml，不是 yml")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" XXX_GROUP  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置分组。未配置时，默认分组是 DEFAULT_GROUP")]),a._v("\n")])])]),t("p",[a._v("通过配置列表右侧的 "),t("code",[a._v("+")]),a._v(" 按钮添加配置文件：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/spring-cloud-alibaba/img/nacos-03.png",alt:"nacos-03"}})]),a._v(" "),t("p",[a._v("点击 "),t("code",[a._v("+")]),a._v(" 按钮之后，页面内容如下：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/spring-cloud-alibaba/img/nacos-04.png",alt:"nacos-04"}})]),a._v(" "),t("p",[t("code",[a._v("Data ID")]),a._v(" 是该配置文件在 Nacos 系统内的唯一标识。")]),a._v(" "),t("p",[a._v("在 Nacos Spring Cloud 中，dataId 的完整格式语法如下：")]),a._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("${prefix}-${spring.profile.active}.${file-extension}\n")])])]),t("ul",[t("li",[t("p",[t("strong",[a._v("prefix")]),a._v(" 的值默认与 "),t("code",[a._v("spring.application.name")]),a._v(" 的值相同。"),t("small",[a._v("也可以通过配置项 "),t("strong",[a._v("spring.cloud.nacos.config.prefix")]),a._v(" 来手动配置，指定一个与 spring.application.name 不一样的值，不过一般不会动它。")])])]),a._v(" "),t("li",[t("p",[t("strong",[a._v("spring.profile.active")]),a._v(" 即为当前环境对应的 profile ，如："),t("code",[a._v("xxx-service-dev.yml")]),a._v(" 中的 "),t("code",[a._v("dev")]),a._v(" 就是指开发环境。")]),a._v(" "),t("p",[a._v("**注意：**当 spring.profile.active 为空时，对应的环境定义字符部分将不存在，即为 "),t("strong",[a._v("xxx-service.yml")]),a._v("，而不是 "),t("em",[a._v("xxx-service-.yml")]),a._v(" 。")])]),a._v(" "),t("li",[t("p",[t("strong",[a._v("file-exetension")]),a._v(" 为配置内容的数据格式，可以通过配置项 "),t("strong",[a._v("spring.cloud.nacos.config.file-extension")]),a._v(" 来配置。注意，yaml 文件的后缀是 yaml ，不是 yml ，这里不能简写。")])])]),a._v(" "),t("p",[t("code",[a._v("Group")]),a._v(" 的值同 spring.cloud.nacos.config.group 的配置，界面填写的内容与项目中的配置二者『"),t("strong",[a._v("一定要统一")]),a._v("』，否则无法正确读取配置，Group 起到配置『隔离』的作用。")]),a._v(" "),t("p",[t("code",[a._v("配置内容")]),a._v("，略。")]),a._v(" "),t("p",[a._v("例如：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://hemiao3000.gitee.io/java-note-img/images/spring-cloud-alibaba/img/nacos-05.png",alt:"nacos-05"}})]),a._v(" "),t("h2",{attrs:{id:"_2-验证和动态刷新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-验证和动态刷新"}},[a._v("#")]),a._v(" 2. 验证和动态刷新")]),a._v(" "),t("p",[a._v("执行以下代码进行验证：")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${xxx.yyy.zzz.username}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${xxx.yyy.zzz.password}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@RequestMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/demo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("demo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" username "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('", "')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("如果想要实现动态刷新功能，那么在 @Value 所在的 @Component（@Controller、@Service、@Repository）上加上 "),t("strong",[a._v("@RefreshScope")]),a._v(" 即可实现动态刷新。")]),a._v(" "),t("h2",{attrs:{id:"_3-nacos-的数据存储"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-nacos-的数据存储"}},[a._v("#")]),a._v(" 3. Nacos 的数据存储")]),a._v(" "),t("p",[a._v("Nacos 的数据是存储在它自带的内嵌 derby 数据库中的，数据文件就在 Nacos 的解压目录下的 "),t("code",[a._v("data")]),a._v(" 文件夹中。")]),a._v(" "),t("p",[a._v("你也可以通过修改配置，让 Nacos 将它的数据存储在你指定的 mysql 数据库中。")]),a._v(" "),t("p",[a._v("Nacos 在它的 "),t("code",[a._v("conf")]),a._v(" 目录下已经为你准备好了建表脚本："),t("code",[a._v("nacos-mysql.sql")]),a._v(" 。不过脚本中有建表语句，但是没有建库语句！为了后续配置简单起见，建议创建的库命名为 nacos 。")]),a._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("create")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("database")]),a._v(" nacos \n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("DEFAULT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CHARACTER")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SET")]),a._v(" utf8mb4 "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 乱码问题")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("DEFAULT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COLLATE")]),a._v(" utf8mb4_bin "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 英文大小写不敏感问题")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("执行完 "),t("code",[a._v("nacos-mysql.sql")]),a._v(" 中的建表 SQL 之后，修改同在 conf 文件夹下的 "),t("code",[a._v("application.properties")]),a._v(" 配置文件。从 31 行开始的一段配置就是数据库连接相关配置。")]),a._v(" "),t("p",[a._v("修改完 "),t("code",[a._v("application.properties")]),a._v(" 配置文件之后，重启 Nacos，你会发现 Nacos 重新编程了一个『干净』的环境。")])])}),[],!1,null,null,null);s.default=e.exports}}]);